xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 2.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0
) +
ylim(0,26) +
geom_line(data = pd_gp_ru_class) +
scale_colour_discrete(name = "")
## Plots for Rural Urban Class-------------------------------------------------------
##
## Plot 4 - line: Setup -----
##
## Plot 4a - line: PowerPoint with annotations ------
ru_annot <- ru_plot +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray",
alpha = 0.8) +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 2.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0
) +
ylim(0,26) +
geom_line(data = pd_gp_ru_class) +
scale_colour_discrete(name = "") +
theme(legend.position = "bottom")
ru_annot
## Plots for Rural Urban Class-------------------------------------------------------
##
## Plot 4 - line: Setup -----
##
## Plot 4a - line: PowerPoint with annotations ------
ru_annot <- ru_plot +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray",
alpha = 0.8) +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 2.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0
) +
ylim(0,26) +
geom_line(data = pd_gp_ru_class) +
geom_line(data = pd_gp_ru_ex_lon) +
scale_colour_discrete(name = "") +
theme(legend.position = "bottom")
ru_annot
## Plots for Rural Urban Class-------------------------------------------------------
##
## Plot 4 - line: Setup -----
##
## Plot 4a - line: PowerPoint with annotations ------
ru_annot <- ru_plot +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray",
alpha = 0.8) +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 2.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0
) +
ylim(0,26) +
geom_line(data = pd_gp_ru_class) +
geom_line(data = pd_gp_ru_lon) +
scale_colour_discrete(name = "") +
theme(legend.position = "bottom")
ru_annot
## Plots for Rural Urban Class-------------------------------------------------------
##
## Plot 4 - line: Setup -----
##
## Plot 4a - line: PowerPoint with annotations ------
ru_annot <- ru_plot +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray",
alpha = 0.8) +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 2.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0
) +
ylim(0,26) +
geom_line(data = pd_gp_ru_class) +
geom_line(data = pd_gp_ru_lon, linetype = 2) +
scale_colour_discrete(name = "") +
theme(legend.position = "bottom")
ru_annot
View(pd_gp_clean)
View(pd_lon)
View(pd_gp_ru_lon)
View(pd_gp_clean)
## Summarise data by rural urban classification --------------------------------
##
pd_gp_ru <- pd_gp_clean %>%
filter(date > as.Date("2018"))
## Summarise data by rural urban classification --------------------------------
##
pd_gp_ru <- pd_gp_clean %>%
filter(date >= as.Date("2019-01-01"))
pd_gp_ru <- pd_gp_clean %>%
group_by(date, rural_urban_overall, covid_period) %>%
summarise(items = sum(items),
list_size = sum(list_size)) %>%
mutate(items_per_1k_pats = items/list_size *1000,
date = as.Date(date),
month = format(date,"%B"),
year = format(date, "%Y"))
## Summarise data by rural urban classification --------------------------------
##
pd_gp_clean <- pd_gp_clean %>%
filter(date >= as.Date("2019-01-01"))
pd_gp_clean %>%
group_by(rural_urban_overall) %>%
summarise(items = sum(items))
pd_gp_clean %>%
group_by(rural_urban_overall) %>%
summarise(items = sum(items),
list_size = sum(list_size)) %>%
mutate(items_per_1k_pats = items/list_size *1000)
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/UCB/scrach.R")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/UCB/scrach.R")
View(lsoa_gp)
View(GPs)
View(lsoa_gp)
lsoa_gp %>% filter(PRACTICE_CODE == "E85124")
lsoa_gp %>% filter(PRACTICE_CODE == "E85124") %>% group_by(PRACTICE_NAME) %>% summarise(count = count(PRACTICE_CODE))
lsoa_gp %>% filter(PRACTICE_CODE == "E85124") %>% group_by(PRACTICE_NAME) %>% summarise(count = n())
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 15),
plot.subtitle = element_markdown(size = 10)),
width = 8,
height = 4.5,
units = "in")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 16),
plot.subtitle = element_markdown(size = 10)),
width = 8,
height = 4.5,
units = "in")
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/csc_per_drug_2_pp.png',
plot = per_d_2,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 10)),
width = 8,
height = 4.5,
units = "in")
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 10)) +
+
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.875,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown"),
size = 2.3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) ,
width = 8,
height = 4.5,
units = "in")
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 10)) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.875,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown"),
size = 2.3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0),
width = 8,
height = 4.5,
units = "in")
##
## Line plot 2 ---------
per_d_2 <- p + labs(
title = "Systemic Corticosteroids Prescription Rates in England",
subtitle = "Not all Systemic Corticosteroids saw a drop in prescription rates during the COVID19 pandemic.<br><span style='color:#D55E00'>Methylprednisolone acetate</span>
and <span style='color:#CC79A7'>Triamcinolone acetonide</span> are injectables only when used systemically,<br>
<span style='color:#56B4E9'>Fludrocortisone acetate</span>, <span style='color:#0072B2'>Hydrocortisone</span>,
<span style='color:#009E73'>Dexamethasone</span> and
<span style='color:#E69F00'>Budesonide</span> have a variety of admission routes.") +
scale_y_continuous(limits = c(0,1),
breaks = c(0, 0.25, 0.5, 0.75, 1)) +
scale_colour_manual(values = cbf_pal_6) +
geom_line(data = filter(pd_cs,
bnf_cs %in% c(
"Fludrocortisone acetate",
"Methylprednisolone acetate",
"Hydrocortisone",
"Dexamethasone",
"Triamcinolone acetonide",
"Budesonide")),
aes(colour = bnf_cs))
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/csc_per_drug_2_pp.png',
plot = per_d_2 +
+
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.9,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown"),
size = 2.5,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) ,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 10)) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.875,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown"),
size = 2.3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0),
width = 8,
height = 4.5,
units = "in")
per_d_1 <- p + labs(title = "<span style='color:#D32728'>Prednisolone</span> Prescription Rates in England",
subtitle = "Prednisolone accounted for nearly 77% of all Systemic Corticosteroids Prescriptions in England") +
scale_y_continuous(limits = c(0,13),
breaks = c(0,3,6,9,12)) +
geom_line(data = filter(pd_parent_compound,
parent_compound == "Prednisolone"),
aes(colour = parent_compound))
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/csc_per_drug_1_pp.png',
plot = per_d_1 +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 1.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0),
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/csc_per_drug_1_word.png',
plot = per_d_1 +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 1.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.5,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0)  +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 12)),
width = 8,
height = 4.5,
units = "in")
ggsave('Dave/plots/csc_per_drug_1_word.png',
plot = per_d_1 +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 1.5,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0)  +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 12)),
width = 8,
height = 4.5,
units = "in")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/Rural_Urban_Line_pp_annot_class.png',
plot = ru_annot,
width = 10,
height = 5.625,
units = "in")
##
## Plot 4b - line: Word with annotations ------
## Save plot for a word document
ggsave('Dave/plots/Rural_Urban_Line_word_annot_class.png',
plot = ru_annot +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 12)),
width = 8,
height = 4.5,
units = "in")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_Rural_Urban_plots.R")
