y = "Items perscribed per 1000 patients",
x = "",
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray") +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 3.4,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.4,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) +
xlim(as.Date("2019-01-01"), as.Date("2021-10-01"))+
scale_colour_manual(values = cbf_pal_6) +
scale_x_date(labels = scales::label_date_short(),
date_breaks = "3 month",
limits = c(as.Date("2019-01-01"), as.Date("2021-10-01")),
expand=c(0,0)) + # holds the axis to the above limits
theme(plot.title = element_markdown(size = 15),
plot.subtitle = element_markdown(size = 10),
panel.grid.major.x = element_blank()) +
geom_line(); p
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/GP_In_Hand_Line_538.png',
plot = p,
width = 10,
height = 5.625,
units = "in")
##
## Plots -----------------------------------------------------------------------
##
## Plot 1: Time Series comparing urban and rural SCS items.
p <- ggplot(pd_gp_clean,
aes(date,
items_per_1k_pats, colour = factor(name))) +
labs(title = "Systemic Corticosteroids Prescription Rates for <span style='color:#E69F00'>England</span>, <span style='color:#0072B2'>London</span> and <span style='color:#009E73'>Babaylon GP at Hand</span>",
subtitle = 'Babylon GP at Hand, a mostly online GP practice based in Hammersmith, has a significantly lower prescription rate that in England or London',
y = "Items perscribed per 1000 patients",
x = "",
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray") +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 3.4,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.4,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) +
xlim(as.Date("2019-01-01"), as.Date("2021-10-01"))+
scale_colour_manual(values = cbf_pal_6) +
scale_x_date(labels = scales::label_date_short(),
date_breaks = "3 month",
limits = c(as.Date("2019-01-01"), as.Date("2021-10-01")),
expand=c(0,0)) + # holds the axis to the above limits
theme(plot.title = element_markdown(size = 15),
plot.subtitle = element_markdown(size = 10),
panel.grid.major.x = element_blank(),
legend.position = "none") +
geom_line(); p
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/GP_In_Hand_Line_538.png',
plot = p,
width = 10,
height = 5.625,
units = "in")
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/GP_In_Hand_Line_pp.png',
plot = p,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/GP_In_Hand_Line_word.png',
plot = ru_annot +
theme(plot.title = element_markdown(size = 14),
plot.subtitle = element_markdown(size = 9)),
width = 8,
height = 4.5,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/GP_In_Hand_Line_word.png',
plot = p +
theme(plot.title = element_markdown(size = 14),
plot.subtitle = element_markdown(size = 9)),
width = 8,
height = 4.5,
units = "in")
s
##
## Plots -----------------------------------------------------------------------
##
## Plot 1: Time Series comparing urban and rural SCS items.
p <- ggplot(pd_gp_clean,
aes(date,
items_per_1k_pats, colour = factor(name))) +
labs(title = "Systemic Corticosteroids Prescription Rates for<br><span style='color:#E69F00'>England</span>, <span style='color:#0072B2'>London</span> and <span style='color:#009E73'>Babaylon GP at Hand</span>",
subtitle = 'Babylon GP at Hand, a mostly online GP practice based in Hammersmith, has a significantly lower prescription rate that in England or London',
y = "Items perscribed per 1000 patients",
x = "",
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray") +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 3.4,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.4,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) +
xlim(as.Date("2019-01-01"), as.Date("2021-10-01"))+
scale_colour_manual(values = cbf_pal_6) +
scale_x_date(labels = scales::label_date_short(),
date_breaks = "3 month",
limits = c(as.Date("2019-01-01"), as.Date("2021-10-01")),
expand=c(0,0)) + # holds the axis to the above limits
theme(#plot.title = element_markdown(size = 15),
#plot.subtitle = element_markdown(size = 10),
panel.grid.major.x = element_blank(),
legend.position = "none") +
geom_line(); p
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/GP_In_Hand_Line_pp.png',
plot = p,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/GP_In_Hand_Line_word.png',
plot = p +
theme(plot.title = element_markdown(size = 14),
plot.subtitle = element_markdown(size = 9)),
width = 9,
height = 5,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/GP_In_Hand_Line_word.png',
plot = p +
theme(plot.title = element_markdown(size = 13),
plot.subtitle = element_markdown(size = 8)),
width = 9,
height = 5,
units = "in")
##
## Plots -----------------------------------------------------------------------
##
## Plot 1: Time Series comparing urban and rural SCS items.
p <- ggplot(pd_gp_clean,
aes(date,
items_per_1k_pats, colour = factor(name))) +
labs(title = "Systemic Corticosteroids Prescription Rates for <span style='color:#E69F00'>England</span>, <span style='color:#0072B2'>London</span> and <span style='color:#009E73'>Babaylon GP at Hand</span>",
subtitle = 'Babylon GP at Hand, a mostly online GP practice based in Hammersmith, has a significantly lower prescription rate that in England or London',
y = "Items perscribed per 1000 patients",
x = "",
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
geom_vline(xintercept = as.Date("2020-01-28"), # first case in the UK
colour = "gray") +
annotate("rect", # first lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-03-26"),
xmax = as.Date("2020-05-17"),
ymin=-Inf, ymax=Inf) +
annotate("rect", # second lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2020-11-05"),
xmax = as.Date("2020-12-02"),
ymin=-Inf,
ymax=Inf) +
annotate("rect", # third lockdown
fill = "gray",
alpha = 0.4,
xmin = as.Date("2021-01-05"),
xmax = as.Date("2021-04-12"),
ymin=-Inf,
ymax=Inf) +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 3.4,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 2.4,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0) +
xlim(as.Date("2019-01-01"), as.Date("2021-10-01"))+
scale_colour_manual(values = cbf_pal_6) +
scale_x_date(labels = scales::label_date_short(),
date_breaks = "3 month",
limits = c(as.Date("2019-01-01"), as.Date("2021-10-01")),
expand=c(0,0)) + # holds the axis to the above limits
theme(plot.title = element_markdown(size = 15),
plot.subtitle = element_markdown(size = 10),
panel.grid.major.x = element_blank(),
legend.position = "none") +
geom_line(); p
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/GP_In_Hand_Line_pp.png',
plot = p,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/GP_In_Hand_Line_word.png',
plot = p +
theme(plot.title = element_markdown(size = 13),
plot.subtitle = element_markdown(size = 8)),
width = 9,
height = 5,
units = "in")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/csc_per_drug_2_pp.png',
plot = per_d_2,
width = 10,
height = 5.625,
units = "in")
##
## Line plot 2 ---------
per_d_2 <- p + labs(title = "Systemic Corticosteroids Prescription Prescription Rates in England",
subtitle = "Not all Systemic Corticosteroids saw a drop in prescription rates during the COVID19 pandemic.<br><span style='color:#D55E00'>Methylprednisolone acetate</span>
and <span style='color:#CC79A7'>Triamcinolone acetonide</span> are injectables only when used systemically,<br>
<span style='color:#56B4E9'>Fludrocortisone acetate</span>, <span style='color:#0072B2'>Hydrocortisone</span>,
<span style='color:#009E73'>Dexamethasone</span> and
<span style='color:#E69F00'>Budesonide</span> have a variety of admission routes.") +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.875,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0)  +
scale_y_continuous(limits = c(0,1),
breaks = c(0, 0.25, 0.5, 0.75, 1)) +
scale_colour_manual(values = cbf_pal_6) +
geom_line(data = filter(pd_cs,
bnf_cs %in% c(
#"Prednisolone",
"Fludrocortisone acetate",
"Methylprednisolone acetate",
"Hydrocortisone",
"Dexamethasone",
"Triamcinolone acetonide",
"Budesonide"
)),
aes(colour = bnf_cs)); per_d_2
dir()
dir(Dave/)
dir(Dave)
dir(/Dave)
dir("Dave")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/run_all.R")
?source
sapply(scripts,source)
sapply(scripts,source)
##
## Script name: Run All
##
## Purpose of script: To produce all plots
##
## Author: David Turner
##
## Date Created: 6 Feb 2022
##
## ## Source scripts  ----------------------------------------------------------
scripts <- list = c("Dave/UCB-DC_IMD_plots.R",
"Dave/UCB-DC_Rural_Urban_plots.R",
"Dave/UCB-DC_national_per_drugs_plots.R",
"Dave/UCB-DC_GP_In_hand_plots.R"
)
##
## Script name: Run All
##
## Purpose of script: To produce all plots
##
## Author: David Turner
##
## Date Created: 6 Feb 2022
##
## ## Source scripts  ----------------------------------------------------------
scripts <- c("Dave/UCB-DC_IMD_plots.R",
"Dave/UCB-DC_Rural_Urban_plots.R",
"Dave/UCB-DC_national_per_drugs_plots.R",
"Dave/UCB-DC_GP_In_hand_plots.R"
)
sapply(scripts,source)
sapply(scripts,source)
per_d_2 <- p + labs(
title = "Systemic Corticosteroids Prescription Prescription Rates in England",
subtitle = "Not all Systemic Corticosteroids saw a drop in prescription rates during the COVID19 pandemic.<br><span style='color:#D55E00'>Methylprednisolone acetate</span>
and <span style='color:#CC79A7'>Triamcinolone acetonide</span> are injectables only when used systemically,<br>
<span style='color:#56B4E9'>Fludrocortisone acetate</span>, <span style='color:#0072B2'>Hydrocortisone</span>,
<span style='color:#009E73'>Dexamethasone</span> and
<span style='color:#E69F00'>Budesonide</span> have a variety of admission routes.") +
annotate("text", # labels
x = c(as.Date("2020-02-02"),
as.Date("2020-03-29"),
as.Date("2020-11-08"),
as.Date("2021-01-08")),
y = 0.875,
label = c("1st C19 Case",
"1st Lockdown",
"2nd Lockdown",
"3rd Lockdown") ,
size = 3,
alpha = 0.7,
angle = -90,
hjust = 0.5,
vjust = 0)  +
scale_y_continuous(limits = c(0,1),
breaks = c(0, 0.25, 0.5, 0.75, 1)) +
scale_colour_manual(values = cbf_pal_6) +
geom_line(data = filter(pd_cs,
bnf_cs %in% c(
#"Prednisolone",
"Fludrocortisone acetate",
"Methylprednisolone acetate",
"Hydrocortisone",
"Dexamethasone",
"Triamcinolone acetonide",
"Budesonide"
)),
aes(colour = bnf_cs)); per_d_2
##
## Save plot to the size of a 16:9 PowerPoint slide
ggsave('Dave/plots/csc_per_drug_2_pp.png',
plot = per_d_2,
width = 10,
height = 5.625,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2,
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 12)),
width = 8,
height = 4.5,
units = "in")
## Save plot for a word document
ggsave('Dave/plots/csc_per_drug_2_word.png',
plot = per_d_2 +
theme(plot.title = element_markdown(size = 17),
plot.subtitle = element_markdown(size = 12)),
width = 8,
height = 4.5,
units = "in")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/run_all.R")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/run_all.R")
source("~/Library/CloudStorage/OneDrive-LondonSchoolofHygieneandTropicalMedicine/Data Challange/lshtm-data-challenge/Dave/UCB-DC_national_per_drugs_plots.R")
##
## Script name: Run All
##
## Purpose of script: To produce all plots
##
## Author: David Turner
##
## Date Created: 6 Feb 2022
##
## ## Source scripts  ----------------------------------------------------------
scripts <- c("Dave/UCB-DC_IMD_plots.R",
"Dave/UCB-DC_Rural_Urban_plots.R",
"Dave/UCB-DC_national_per_drugs_plots.R",
"Dave/UCB-DC_GP_In_hand_plots.R"
)
sapply(scripts,source)
##
## Plot 2: Box plot. -------
imd_box <- ggplot(pd_gp_imd, aes(x = items_per_1k_pats,
y = deprivation_decile,
colour = deprivation_decile)) +
geom_boxplot() +
labs(title = "Average Systemic Corticosteroids Prescriptions per the Indices<br>of Multiple Deprivation (IMD) Decile",
subtitle = "England - May 2018 to October 2019",
y = "IMD Decile",
x = "Items per 1000 patients",
colour='',
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
scale_colour_manual(values = cbf_pal) +
theme(panel.grid.major.y = element_blank(),
axis.text.y = element_text(),
legend.position = "none")
imd_box
ggplot(pd_gp_clean, aes(items_per_1k_pats, colour = deprivation_decile)) +
geom_boxplot() +
labs(title = 'Systemic Corticosteroids Prescriptions in Rural and Urban Areas',
subtitle = 'Average Prescribing Rate\nApr 2019 - Oct 2021',
y = "",
x = "Items perscribed per 1000 patients",
colour='',
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
scale_colour_discrete(name="",
breaks=c("rural", "urban"),
labels=c("Rural", "Urban")) +
theme(panel.grid.major.y = element_blank(),
axis.text.y = element_blank())
##
##
##
## Plot 2: Box plot......
ggplot(pd_gp_imd, aes(items_per_1k_pats, colour = deprivation_decile)) +
geom_boxplot() +
labs(title = 'Systemic Corticosteroids Prescriptions in Rural and Urban Areas',
subtitle = 'Average Prescribing Rate\nApr 2019 - Oct 2021',
y = "",
x = "Items perscribed per 1000 patients",
colour='',
caption = "Source: OpenPrescribing.net, EBM DataLab, University of Oxford, 2017") +
scale_colour_discrete(name="",
breaks=c("rural", "urban"),
labels=c("Rural", "Urban")) +
theme(panel.grid.major.y = element_blank(),
axis.text.y = element_blank())
